# 工作中常用到的SQL

作者：Java3y
链接：https://www.zhihu.com/question/19552975/answer/817374798
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。



我前阵子整理一下**工作中常用到的SQL：****前言**
只有光头才能变强。
文本已收录至我的GitHub仓库，欢迎Star：https://github.com/ZhongFuCheng3y/3y最近在公司做了几张报表，还记得刚开始要做报表的时候都快把SQL给忘光了（当时在广州休假了1个月多，在实习期间也没咋写过SQL），回到公司的第一个需求就是做报表。于是我很不要脸地跟带我的学长说：“SQL我好像忘光了，group 分组查询好像都忘得差不多了，我得复习一下”。这篇文章来记录一下我曾经**忘掉**的group查询、join查询等一些比较**实用/常用**的SQL本文主打**通俗易懂**，不涵盖任何优化(适合新手观看)**一、回顾group 查询**`group`查询就是分组查询，为什么要分组查询？因为我们想按某个维度进行统计。下面来看个图：![img](https://pic1.zhimg.com/50/v2-e8be801a3ac5f0dce01a39b0bac147f6_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-e8be801a3ac5f0dce01a39b0bac147f6_r.jpg?source=1940ef5c)比如说，我想知道：`每天Java3y这个公众号的点击量是多少。`按我们人工而言，思路很简单：把相同的天数以及公众号名称为Java3y的数据找出来，再将每个点击量相加，就得出了结果了。![img](https://pic4.zhimg.com/50/v2-f86f3178b2d23ba3e94684e7d5653abf_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-f86f3178b2d23ba3e94684e7d5653abf_r.jpg?source=1940ef5c)用上SQL我们可能会这样写：`select name,time,sum(pv) as pv   from xxx_table  where name = 'Java3y' group by name,time `**1.1 group 查询可能存在的误解**记得有一天，有个群友在群上问了一个问题：![img](https://pic1.zhimg.com/50/v2-865eb1083be1e2aa26185023d7c22804_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-865eb1083be1e2aa26185023d7c22804_r.jpg?source=1940ef5c)其实他的需求很简单：检索出数据分组后时间最高的记录。但他是这样干的：把先按照时间 `order by`对`order by`后的记录进行分组示例图：![img](https://pic2.zhimg.com/50/v2-8c5e41ed5949f2ffd107ebfef8783279_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-8c5e41ed5949f2ffd107ebfef8783279_r.jpg?source=1940ef5c)**1.2 造成这个误解的可能原因**有的工具可以支持这种的写法：`select * from xxx_table group by name `这种写法没有被禁止，并可以得出结果，比如得到的结果是：`Java4y    20  7月15号 Java3y    30  7月15号 `这种写法其实是不合理的，要知道的是：使用`group by`分组统计之后，我们的select 后面只能跟着group by 的字段，或者是聚合函数。![img](https://pic2.zhimg.com/50/v2-4a238a28a450befd41e59239c03981d2_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-4a238a28a450befd41e59239c03981d2_r.jpg?source=1940ef5c)因为，我们对数据进行了分组查询，**数据的分布情况，我们是不关心的**。记住：**先分组，后统计**(先把数据归类后，再对相同的数据进行统计)**1.3 group查询最常用的SQL****去重**是我们经常会遇到的问题，打个比方说，由于各种原因（不管是业务上还是说是脏数据），现在我有两条重复的数据（除了ID，其余的字段都是相同的）：![img](https://pic4.zhimg.com/50/v2-5b36dc64676f1497e94ae5b299c0413d_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/80/v2-5b36dc64676f1497e94ae5b299c0413d_720w.jpg?source=1940ef5c)我这边只希望留下某一条记录作为查询结果就好了，我们可以写下以下的SQL：`select * from user where id in(   select min(id) from user where name = 'Java3y' and pv = 20 and time='7-25' group by name,pv,time; ) `上面这条SQL是非常非常实用的，除了我说的去重以外，其实我们可以再”思考“一下：上面已经说了，使用`group by`分组统计之后，我们的select 后面只能跟着group by 的字段，或者是聚合函数。很多时候我们`group by`了以后，还想要查询结果中包含`group by`之外的字段(一般情况下，我们都不可能将group by 涵盖所有的字段)，我们就可以上面那样，将查询后的结果作为子查询，放在外部查询的where 子句后，这样外部查询是可以select 出其他字段的。(SQL写得比较少的朋友可能没什么感触啊，但我希望上面那种写法大家能够记住，以后一定会遇到**类似**的情况的)**二、回顾join查询**join查询不知道大家在刚学的时候是怎么理解的，反正我当初好像就挺迷迷糊糊的。我觉得join查询可以简单理解成这样：**我想要的查询结果，一张表搞不掂，那我就join另一张表**比如说，现在我有两张的表：![img](https://pic2.zhimg.com/50/v2-51459f7af85812f6d5d21cd0a5196e98_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-51459f7af85812f6d5d21cd0a5196e98_r.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/50/v2-18bef610c60545a165299a30ebafaaaa_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-18bef610c60545a165299a30ebafaaaa_r.jpg?source=1940ef5c)现在我想知道在7月25号时：每个公众号的点击量、公众号名称、号主名称、公众号的创建日期显然，我们会发现**一张表搞不掂**啊，某些数据要依赖于另一张表才能把数据"完整"展示出来那join其实就是把两张表合起来的一个操作：![img](https://pic4.zhimg.com/50/v2-3bf6ea1acb1c3d7a317797f23dcf0e17_hd.jpg?source=1940ef5c)![img](https://pic3.zhimg.com/v2-3bf6ea1acb1c3d7a317797f23dcf0e17_r.jpg?source=1940ef5c)两张表合并起来以后我们就会发现，这张“大表”就含有这两张表的所有字段啦，那我想要什么都有了！值得注意的是：在join的时候，会产生笛卡尔积（至于什么是笛卡尔积我这里就不说了，反正我们要记住的是**join表时一定要写关联条件去除笛卡尔积**）另外，`left join`和`right join`也是我们经常用到，如果我们单纯写`join`关键字，那会被当成是`inner join` 。下面我简单解释一下：上面说了，在join的时候一定要写**关联条件**，如果是`inner join`的话，只有符合关联条件的数据才会存在最大表中如果是`left join`的话，即便关联条件不符合，左边表的数据一定会存在大表中如果是`right join`的话，即便关联条件不符合，右边表的数据一定会存在大表中看下面的图：![img](https://pic2.zhimg.com/50/v2-1497d8643567dd3ac05535b77d4880b0_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-1497d8643567dd3ac05535b77d4880b0_r.jpg?source=1940ef5c)此时我们的两张表关联的条件是“公众号” ：如果是`inner join`，那么最后我们的表只有两条记录。如果是`left join` ，那么最后我们的表有三条数据。如果是`right join`，那么我们最后的表只有两条数据**三、回顾case when**SQL中的case when then else end用法其实跟我们程序语言中的`if-else`很是类似，在写SQL的时候也常常会用到。我用得比较多的语法如下：`CASE WHEN sex = '1' THEN '男'         WHEN sex = '2' THEN '女' ELSE '其他' END    `在when后面可以跟多个表达式，比如说：`CASE WHEN sex = '1' and name ='Java3y' THEN '男'         WHEN sex = '2' and name ='Java4y' THEN '女' ELSE '其他' END    `如果要为`case when`表达式取别名，在`end` 关键字后边直接加就好了更多用法详情参考：https://www.cnblogs.com/prefect/p/5746624.html**四、一些常用的函数****4.1 hive和presto解析json**我这边会有这种情况：将json数据存到MySQL上。我去网上搜了一下以及问了同事，为什么要将json存到MySQL的字段上时，他们的答复都差不多：在MySQL存json数据，这样方便扩展啊。如果那些字段不需要用到索引，改动比较频繁，你又不想改动表的结构，那可以存json。ps:在MySQL 5.7版本以后支持json类型参考资料：https://cloud.tencent.com/developer/article/1004449https://www.zhihu.com/question/324674084/answer/685522547我这边做报表一般来hive或presto上搞的，所以解析json的也是在那上面。hive解析json函数：`get_json_object(param1,'$.param2') -- 如果是数组 get_json_object(xjson，'$.[0].param2') `presto 对json的处理函数:` -- 数组  (去除第index个json) json_array_get(xjson,index)   -- 单个jsoin对象 json_extract(xjson,'$.param2') `参考资料：https://www.cnblogs.com/drjava/p/10536922.html**4.2 时间函数**昨天/近7天/本月按照这种指标来查询也是非常常见的：`昨天 SELECT * FROM 表名 WHERE TO_DAYS( NOW( ) ) - TO_DAYS( 时间字段名) <= 1 7天 SELECT * FROM 表名 where DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= date(时间字段名) 近30天 SELECT * FROM 表名 where DATE_SUB(CURDATE(), INTERVAL 30 DAY) <= date(时间字段名) 本月 SELECT * FROM 表名 WHERE DATE_FORMAT( 时间字段名, '%Y%m' ) = DATE_FORMAT( CURDATE( ) , '%Y%m' ) 上一月 SELECT * FROM 表名 WHERE PERIOD_DIFF( date_format( now( ) , '%Y%m' ) , date_format( 时间字段名, '%Y%m' ) ) =1 `在presto中使用时间格式，需要明确写出关键字`timestamp`，比如：`select supplier,count(id)  from xxx_table  where sendtime >= timestamp '2019-06-01'  `参考资料：https://blog.csdn.net/cool_easy/article/details/50880949**4.3 其他常用的函数**这里我简单整理一下我最近用过函数：`length  --计算字符串长度 concat  --连接两个字符串 substring -- 截取字符串 count   -- 统计数量 max   -- 最大 min   -- 最小 sum   -- 合计 floor/ceil  --...数学函数 `再来分享一下最近遇到的一个需求，现在有的数据如下：`【Java3y简单】快乐学习 【Java3y简单】快乐学习渣渣 【Java3y通俗易懂】简单学 【Java3y通俗易懂】简单学芭芭拉 【Java3y平易近人】无聊学 【Java3y初学者】枯燥学 【Java3y初学者】枯燥学呱呱 【Java3y大数据】欣慰学 【Java3y学习】巴拉巴拉学 【Java3y学习】巴拉巴拉学哈哈 【Java3y好】雨女无瓜学 `现在我统计出【】括号里边出现的频次，比如说：`Java3y通俗易懂`出现的频次是多少。当时一直都没想到好的思路，都快要搜“SQL 正则表达式 快速入门”了，请教了一下同事，同事很快就写出来了：`select substring_index(left(title , INSTR(title , '】') -1 ) , '【',-1)  FROM `xxx_table` `**哇~，awesome**
**更多原创文章：**[数据库面试题(开发者必看)](https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247483856&idx=1&sn=ea1c06f0852d3bca3b98b64d8589598e&chksm=ebd740d1dca0c9c77ed1bb07a96bd0fbe147a13515797cf71597de821dbe3357e3eef5f741dc&scene=21#wechat_redirect)[数据库两大神器【索引和锁】](https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247484721&idx=1&sn=410dea1863ba823bec802769e1e6fe8a&chksm=ebd74430dca0cd265a9a91dcb2059e368f43a25f3de578c9dbb105e1fba0947e1fd0b9c2f4ef&token=1676899695&lang=zh_CN&scene=21#wechat_redirect)[面试前必须知道的MySQL命令【expalin】](https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247484461&idx=2&sn=5469534e2f370aba86c3a24a2ff52b70&chksm=ebd7452cdca0cc3ad456d695a78f48e72c245f85b4afb210fb7b62218e89785d964d72ec4891&token=620000779&lang=zh_CN&scene=21#wechat_redirect)[数据库原理](https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247483866&idx=4&sn=5c0522bdc0f0ea8946354c9c633fe1d7&chksm=ebd740dbdca0c9cd6ba6b332f753b6472c4e32d9f79b3d8a062b8b2ddab650bd21b616bf3a99&scene=21#wechat_redirect)[Oracle总结【SQL细节、多表查询、分组查询、分页】](https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247483866&idx=1&sn=e54943e5abbbe1b98ee7aeaf12c685ad&chksm=ebd740dbdca0c9cdd3f943f6b28efb70603f84b9bc2af0aa8a4143468a0a325cac58b319b52f&scene=21#wechat_redirect)[Oracle总结【视图、索引、事务、用户权限、批量操作】](https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247483866&idx=2&sn=875f073fe972cef7e1f02d111f1dfc96&chksm=ebd740dbdca0c9cdfc84a483134f7ad99d6dc8ebb15ddaa8e04ac37025417cf3f84c3169a248&scene=21#wechat_redirect)[Oracle总结【PLSQL学习】](https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247483866&idx=3&sn=dfaf9fe2eb2675fa0873548f95105fad&chksm=ebd740dbdca0c9cdf2e77187fa86f24b785208ce197d80eb3abe9ea952e9f40b9c780a31a950&scene=21#wechat_redirect)

http://weixin.qq.com/r/uDgqMjPEOW5GrXdR922q (二维码自动识别)![img](https://pic4.zhimg.com/50/v2-17af0767c0c85178d2e722ba48172f61_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-17af0767c0c85178d2e722ba48172f61_r.jpg?source=1940ef5c)**有帮助？点赞！对我很重要！**关注我的公众号：**Java3y**，获取更多的**原创**笔记，海量视频资源/原创思维导图/学习路线**两年呕心沥血的文章导航**：https://github.com/ZhongFuCheng3y/3y(**欢迎star**)

[编辑于 2019-09-08](http://www.zhihu.com/question/19552975/answer/817374798)

赞同 4添加评论

分享

收藏喜欢



收起

继续浏览内容

![img](https://pic1.zhimg.com/80/v2-10e18ff65a640175ad058b4b5dfd2867_1440w.png)

知乎

发现更大的世界

打开

![img](https://picb.zhimg.com/80/v2-a448b133c0201b59631ccfa93cb650f3_1440w.png)

Chrome

继续



[![王树义](https://pic4.zhimg.com/v2-9c326634115ea56ef90f8bcea6fd5c76_xs.jpg?source=1940ef5c)](http://www.zhihu.com/people/wang-shu-yi-11)

[王树义](http://www.zhihu.com/people/wang-shu-yi-11)[](https://www.zhihu.com/question/48510028)

南开大学 情报学博士

39 人赞同了该回答

如果你需要用 SQL 探索和分析数据库，那么现在的好消息是，你**可以不必学它**了。数据分析的门槛在降低，希望你能及时意识到。**需求**今天是本学期《数据库系统原理》的最后一课。学生们完成了数据分析项目，依次上台做展示。![img](https://pic2.zhimg.com/50/v2-c7375a9ee24477d45240c9d49239c61e_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-c7375a9ee24477d45240c9d49239c61e_r.jpg?source=1940ef5c)看到连计算机扫盲课都没有上过的文科生，经过一个学期的学习，能够自己从网上找数据，导入关系型数据库，用 SQL 来做查询，直到**以数据来回答自己感兴趣的问题**，我觉得很开心。在这个大数据时代，我们每个人的工作，都或多或少要跟数据打交道。小到记录自己的账本，大到用数据辅助企业战略决策。用好数据，可以帮助你所在的团队，和你个人增值。有价值的数据，许多都存储在了各种数据库里面。想要使用好它们，只会用 Excel 或者 Access 是不够的。一般来说，查询它们的最好方式，是学会各种查询语言。最常见的，就是 SQL。在著名的 Python 课程 Programming for Everybody 里面，主讲教授密歇根大学的 Chuck (Dr. Charles Severance) 认为，SQL 语言是编程语言中**最简单的一种**。![img](https://pic2.zhimg.com/50/v2-3470af7cb235c84cbaf5a5e8b7e43c44_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-3470af7cb235c84cbaf5a5e8b7e43c44_r.jpg?source=1940ef5c)但是，我们还是现实一点。许多时候，你有分析数据的冲动，然而并非人人都有时间和意愿去学一门 SQL 课程，来完成日常工作中的数据查询、分析和可视化工作。**工具**好在，技术的发展，总是把很多原先专业人士才能做的事儿，变成大众都能做的。例如自动挡汽车，例如手机上的相机应用，再例如我今天要给你介绍的 Metabase 。Metabase 的 Slogan ，是这个样子的。![img](https://pic4.zhimg.com/50/v2-cc7ecb8173a2d17a79ed5db5f25176f9_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-cc7ecb8173a2d17a79ed5db5f25176f9_r.jpg?source=1940ef5c)翻译过来，重点就是：所有人都能用可以容易表达你的问题使你能从数据中学习**安装**我们来尝试一下。Metabase 这款工具，完全可以适用于团队协作，因为它提供了 Docker 镜像、AWS 和 Heroku 等方便的云端使用方式。![img](https://pic2.zhimg.com/50/v2-bf0ba5892ca7c5762af6a26e4a800e2e_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-bf0ba5892ca7c5762af6a26e4a800e2e_r.jpg?source=1940ef5c)为了介绍的简单与方便，这里我只给你介绍一下单机版的安装。其余的应用形式，你可以学习本文之后，自己继续挖掘。因为我自己使用的是 macOS ，所以这里选择 Mac 下面编译好的安装文件就行。![img](https://pic4.zhimg.com/50/v2-6d1eb53f35e3a9bde02ac7c980f1c333_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-6d1eb53f35e3a9bde02ac7c980f1c333_r.jpg?source=1940ef5c)如果你使用的是其他系统，例如 Linux 或者 Windows ，安装也不麻烦。只需要点击 “其他平台” 按钮，下载一个 jar 类型文件。只要你在系统里面安装好 Java 运行环境，就可以直接双击该文件运行了。![img](https://pic2.zhimg.com/50/v2-b18778da912afd0582a8c8e677f58967_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-b18778da912afd0582a8c8e677f58967_r.jpg?source=1940ef5c)这里以我电脑上的 macOS 系统为例。打开下载的 dmg 文件后，把可执行文件拖入到 “应用” 文件夹，就可以了。![img](https://pic4.zhimg.com/50/v2-cb97b94b0a634a55bb6a9e9d5a47c9a8_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-cb97b94b0a634a55bb6a9e9d5a47c9a8_r.jpg?source=1940ef5c)
第一次运行的时候，可能需要一些时间初始化。
![img](https://pic4.zhimg.com/50/v2-c0dc16ee27035b4fc0131ba31e3301eb_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-c0dc16ee27035b4fc0131ba31e3301eb_r.jpg?source=1940ef5c)当出现以下界面的时候，就意味着准备就绪了。![img](https://pic2.zhimg.com/50/v2-826532f4f5e843f5f31e55355fadd250_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-826532f4f5e843f5f31e55355fadd250_r.jpg?source=1940ef5c)请你点击上图里面的蓝色按钮，开始设置。我们需要输入一些基本注册信息。![img](https://pic1.zhimg.com/50/v2-88f8ed561179113cdf3f5b414357e2c3_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-88f8ed561179113cdf3f5b414357e2c3_r.jpg?source=1940ef5c)之后，选择我们需要连接的数据库。  ![img](https://pic1.zhimg.com/50/v2-ce8931a46c3b31543d71648b882aa9e0_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-ce8931a46c3b31543d71648b882aa9e0_r.jpg?source=1940ef5c)注意，这里有很多选项可以选择。这些选项，基本上涵盖了市面上常见的主流数据库类型。![img](https://pic4.zhimg.com/50/v2-d31f4f2fda2e9512e8e14d4a74dacb46_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/80/v2-d31f4f2fda2e9512e8e14d4a74dacb46_720w.jpg?source=1940ef5c)为了方便起见，这里我们使用 “麻雀虽小五脏俱全” 的 SQLite 数据库。其他类型的数据库，你可以稍后自己尝试。我用的样例，是 Stanford 数据库开放课程使用的 colleges.db 。我自己上课的时候，一直用它作为基础样例演示给学生。![img](https://pic4.zhimg.com/50/v2-1e4e99c7fd4abb111d52f05b0328e383_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-1e4e99c7fd4abb111d52f05b0328e383_r.jpg?source=1940ef5c)设置完毕之后，下面需要注意，有个数据统计选项。 Metabase 是在询问你，是否允许把你的使用行为统计信息发给它，帮助改进。![img](https://pic2.zhimg.com/50/v2-0d30b374222fb4e2cbf325e139c443aa_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-0d30b374222fb4e2cbf325e139c443aa_r.jpg?source=1940ef5c)如果你乐于分享，可以保持原先设定。若对自己的隐私比较注重，不用纠结了，可以关闭该选项。![img](https://pic4.zhimg.com/50/v2-fcafb4cf90afcf8871624fd6a6f6af54_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-fcafb4cf90afcf8871624fd6a6f6af54_r.jpg?source=1940ef5c)到这里，安装和设置就算完成了。**浏览**下面我们看看有哪些数据表可以查看。这个数据库里面包含了 3 张表格，分别是：Student 学生信息 Apply 申请信息 College 招生学校信息![img](https://pic1.zhimg.com/50/v2-6a74149a8553c4acda16d158611ef3f8_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-6a74149a8553c4acda16d158611ef3f8_r.jpg?source=1940ef5c)我们选择其中的学生表格。![img](https://pic2.zhimg.com/50/v2-a78a87b7c4766792c5a294319919a350_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-a78a87b7c4766792c5a294319919a350_r.jpg?source=1940ef5c)Metabase 默认给了我们一些基本的描述性统计结果。例如最重要的，是一张表格到底有多少行。这里样例 Student 表里，一共有 12 个学生的记录。还没完，往下翻， Metabase 还为我们自动生成了一些其他统计结果。首先是学生的学号分布。![img](https://pic4.zhimg.com/50/v2-fe0d5a0c63d0292070bd3df74a934c17_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-fe0d5a0c63d0292070bd3df74a934c17_r.jpg?source=1940ef5c)当然，由于学号无非是个独特数字而已，所以这个统计没有什么用处。但下面这张，就不一样了。![img](https://pic3.zhimg.com/50/v2-300c45dfa6a3f2b1998ce06eabf0a075_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-300c45dfa6a3f2b1998ce06eabf0a075_r.jpg?source=1940ef5c)这是学生的 GPA 分布，可见，大部分学生的成绩高于 3.6 分。数据集**不是**个均匀或者正态分布。![img](https://pic2.zhimg.com/50/v2-1b4f51d65b6cd358db348c2fa87e56d4_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-1b4f51d65b6cd358db348c2fa87e56d4_r.jpg?source=1940ef5c)上面这张图，反映了学生来自的高中学校大小。看得出来，大部分学生还是来自于学生人数较多的学校。来自小而精的高中学生人数，相对较少。![img](https://pic2.zhimg.com/50/v2-6c98eb32d21a923c481317f4f9b53d9b_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-6c98eb32d21a923c481317f4f9b53d9b_r.jpg?source=1940ef5c)后面这张图，统计了学生姓名。有意思的是，你可以清楚看到，有**重名**的学生。如果你不满足于只看这些统计信息，而希望查看原始数据。那么可以点击 “Browse Data” 按钮，选择 college 数据库。![img](https://pic2.zhimg.com/50/v2-48a69356ef4768a241a27cf0daeb03d0_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-48a69356ef4768a241a27cf0daeb03d0_r.jpg?source=1940ef5c)然后选择其中的 Student 表格，就能看到全部学生记录信息。![img](https://pic4.zhimg.com/50/v2-a5216eb6e129295cba9fbed268490336_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-a5216eb6e129295cba9fbed268490336_r.jpg?source=1940ef5c)**分析**如果我们只关注其中一部分学生的情况，可以选择上方紫色的 “Filter”（过滤）按钮。![img](https://pic4.zhimg.com/50/v2-4bb13c67dff51352235bf0449a9e32ab_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-4bb13c67dff51352235bf0449a9e32ab_r.jpg?source=1940ef5c)
这里，所有的条件，都可以通过选择和输入数值来完成，不需要编程。我们选择过滤结果只保留 GPA 大于 3.5 的学生。
![img](https://pic4.zhimg.com/50/v2-5fd04cedf20ba5ac74acf208cff65422_hd.jpg?source=1940ef5c)![img](https://pic3.zhimg.com/v2-5fd04cedf20ba5ac74acf208cff65422_r.jpg?source=1940ef5c)上图左侧就是我们想看的结果了。但是我们会觉得，“一幅图胜似千言万语”。怎么办呢？我们选择右下方，以 GPA 作为分组依据，然后点击左下方的 Visualization （可视化）按钮。![img](https://pic3.zhimg.com/50/v2-5fd04cedf20ba5ac74acf208cff65422_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-5fd04cedf20ba5ac74acf208cff65422_r.jpg?source=1940ef5c)可见，在成绩大于 3.5 的学生里面，有 4 个是 3.9 分的成绩。这部分学生里面，学霸占的比例不小啊。![img](https://pic2.zhimg.com/50/v2-1c9d022833de4047437a6613d0bee59c_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-1c9d022833de4047437a6613d0bee59c_r.jpg?source=1940ef5c)我们还可以换一种分组方式，这里我们使用高中学校人数作为分组依据。然后再次进行可视化。![img](https://pic4.zhimg.com/50/v2-e248e4b9e1a3b343fe1f0292bfcc71ef_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-e248e4b9e1a3b343fe1f0292bfcc71ef_r.jpg?source=1940ef5c)于是你可以看到，GPA 3.5 分以上的学生，来自于人数规模 1000 的高中最多。点击可视化按钮，我们可以选择不同的图形来表示。这里我们选择饼图。  ![img](https://pic4.zhimg.com/50/v2-faa81b353ece961a04add66ab4e756bb_hd.jpg?source=1940ef5c)![img](https://pic3.zhimg.com/v2-faa81b353ece961a04add66ab4e756bb_r.jpg?source=1940ef5c)你觉得在这个问题里，柱状图和饼图，哪个更适合描述咱们的过滤分析结果呢？**地图**下面我们来看看，如何对数据进行地理信息可视化。也就是，画个地图出来。这里，我们选用的，是其中 College 这张表格。这张表格里面，包含以下信息。![img](https://pic2.zhimg.com/50/v2-65a7b5be3de0becac1a56433375574b2_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-65a7b5be3de0becac1a56433375574b2_r.jpg?source=1940ef5c)我们打算看看，不同州大学的录取人数。做法很简单。还是点击 Visualization 。![img](https://pic4.zhimg.com/50/v2-bd832283cc446f4e22c0dd9d4d8c6e14_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-bd832283cc446f4e22c0dd9d4d8c6e14_r.jpg?source=1940ef5c)选择图形选项最右下方的 “地图”(Map)。![img](https://pic4.zhimg.com/50/v2-97e2ab826f5103b4450eec12f6800dd5_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/80/v2-97e2ab826f5103b4450eec12f6800dd5_720w.jpg?source=1940ef5c)修改 Metric field 为 Enrollment 。然后 Region Field 为 State （州）。于是你就能看见下面这样的地图了。![img](https://pic4.zhimg.com/50/v2-5a049c6370e80f1d7671255a7845b407_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-5a049c6370e80f1d7671255a7845b407_r.jpg?source=1940ef5c)有意思的是，Metabase 对于州的简写方式也能正确识别，并且把它们标记在地图上。而且根据汇总招生人数的多寡，还自动选择了不同深浅的颜色。**关联**下面我们来看看更实用的分析手段 —— 关联查询。从一张表里，我们已经可以分析出不少东西了。但是更多情况下，我们希望采用多张表格联合在一起，从而能从中挖掘出洞见（Insights）。例如这里我给你提一个问题： 不同大学录取最低 GPA 是多少？  这个问题，你若是只用一张表，是无非回答的。因为 Apply 表里面虽然有录取决策信息，但是不包含 GPA；Student 表里面虽然包括了 GPA，但你不知道学生报了哪所学校，以及是否被录取了。让我们点击上方菜单栏里面的 “问问题”（Ask a question）按钮，然后从下图中选择 “定制问题”(Custom Question)。![img](https://pic1.zhimg.com/50/v2-a8f39cbca7e498f7e7b1a01ce54ad3a7_hd.jpg?source=1940ef5c)![img](https://pic3.zhimg.com/v2-a8f39cbca7e498f7e7b1a01ce54ad3a7_r.jpg?source=1940ef5c)然后，你需要选择数据库。![img](https://pic2.zhimg.com/50/v2-d98e17071a840c6e539ab7bf201e202a_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-d98e17071a840c6e539ab7bf201e202a_r.jpg?source=1940ef5c)还得选择一个初始的表格。![img](https://pic2.zhimg.com/50/v2-c22fdf3d7c02249d2d29c482b6b1dd09_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-c22fdf3d7c02249d2d29c482b6b1dd09_r.jpg?source=1940ef5c)
我们选择 Student 表。![img](https://pic4.zhimg.com/50/v2-4cb2b742958fb97837c54e9b2db26262_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-4cb2b742958fb97837c54e9b2db26262_r.jpg?source=1940ef5c)
然后选择 Join data （关联数据）。![img](https://pic4.zhimg.com/50/v2-669f21c508b08e5b68be51961407ca1f_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-669f21c508b08e5b68be51961407ca1f_r.jpg?source=1940ef5c)这里我们需要选择 Apply 表格。  ![img](https://pic1.zhimg.com/50/v2-321d77aa37e2de1c3b25b4bfbd27ecdc_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-321d77aa37e2de1c3b25b4bfbd27ecdc_r.jpg?source=1940ef5c)
然后会让我们选择用哪个列进行关联。毕竟，如果我们把张三的学生信息关联到李四的录取信息记录上，是没有意义的。![img](https://pic4.zhimg.com/50/v2-379f47f0859441f26f57537f3a8c1bfd_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-379f47f0859441f26f57537f3a8c1bfd_r.jpg?source=1940ef5c)
我们观察一下，发现在 Student 和 Apply 中，都出现了学生的 ID （sID），这是学生的唯一标识。就用它好了。
![img](https://pic4.zhimg.com/50/v2-0480b566a0230b8de656e17c99235a94_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-0480b566a0230b8de656e17c99235a94_r.jpg?source=1940ef5c)下面我们设置一下过滤条件。显然，既然考虑录取分数，那么就得找出那些被录取的人。于是我们在 Filter 一栏里面点击。![img](https://pic2.zhimg.com/50/v2-6a97257654b45443023d727f986d1014_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-6a97257654b45443023d727f986d1014_r.jpg?source=1940ef5c)选择 Apply 表格。![img](https://pic4.zhimg.com/50/v2-bb860a3cf2d7e0f69f1f82fe779316ad_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-bb860a3cf2d7e0f69f1f82fe779316ad_r.jpg?source=1940ef5c)
然后从中选择 Decision （录取决策）。
![img](https://pic2.zhimg.com/50/v2-5efc9b1926968f473b546847015fcfbb_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-5efc9b1926968f473b546847015fcfbb_r.jpg?source=1940ef5c)
因为这里只有两种取值选择。所以我们可以选择 Y （录取）。
![img](https://pic4.zhimg.com/50/v2-ba5cb5a3c856d18d5bd21f4fe3059691_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-ba5cb5a3c856d18d5bd21f4fe3059691_r.jpg?source=1940ef5c)然后我们就可以根据学校来查看最低录取分数了。这里我们填写绿色的 Summarize 。![img](https://pic2.zhimg.com/50/v2-272c90ed4e55b1fbf364c7e985e4ffde_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-272c90ed4e55b1fbf364c7e985e4ffde_r.jpg?source=1940ef5c)
我们感兴趣的是最低录取分数，所以可以从中选择 Minimum of 。
![img](https://pic4.zhimg.com/50/v2-bd20a851df069539a233c7d4a5971685_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-bd20a851df069539a233c7d4a5971685_r.jpg?source=1940ef5c)
然后选择 GPA 作为最小值选择列。
![img](https://pic4.zhimg.com/50/v2-bd20a851df069539a233c7d4a5971685_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-bd20a851df069539a233c7d4a5971685_r.jpg?source=1940ef5c)
还没完。因为我们是需要按照学校来分别计算的。所以在 by 后面选择 cName 。
![img](https://pic2.zhimg.com/50/v2-17157b5b3494f91a74c7e1783bfca4dd_hd.jpg?source=1940ef5c)![img](https://pic4.zhimg.com/v2-17157b5b3494f91a74c7e1783bfca4dd_r.jpg?source=1940ef5c)通过简单的点选，你现在已经有了所有需要设置的信息。![img](https://pic2.zhimg.com/50/v2-39b2063c3525bddcb4fed6d7f608df6b_hd.jpg?source=1940ef5c)![img](https://pic1.zhimg.com/v2-39b2063c3525bddcb4fed6d7f608df6b_r.jpg?source=1940ef5c)好，我们执行吧。选择 Visualize 。![img](https://pic2.zhimg.com/50/v2-2ed06c6214bb1195b3463964db5f1e2e_hd.jpg?source=1940ef5c)![img](https://pic2.zhimg.com/v2-2ed06c6214bb1195b3463964db5f1e2e_r.jpg?source=1940ef5c)从这张图里，我们可以看到，Berkeley 录取学生的 GPA 线最高。 Cornell 和 Stanford 并列最低。由此看来，名校看重的，绝不仅仅是 GPA 成绩啊。是吗？这个作为思考题，欢迎你把自己的答案写在留言区里面和大家交流。**小结**本文我带你用一个极简的数据库样例，尝试了不写任何一句 SQL 代码，对数据库进行过滤、分析、统计、可视化，以及表间关联查询。你可能会觉得，这么简单的数据，我拿眼看心算，都比你这方法快！没错，但是想象一下，如果你的每张表里面，数据量都多上 1000 倍呢？我们要学东西，就需要掌握这种能规模化应用的技能。虽然初始学习的时候觉得有些繁琐，但是真正帮你应对大规模数据结果的时候，你就能尝到掌握它的甜头了。祝数据分析愉快！读过本文，如果觉得有收获，请**点赞**。要读更多的文章，微信关注我的公众号 [“玉树芝兰”(nkwangshuyi)](https://tva1.sinaimg.cn/large/006y8mN6ly1g7c5l5bit2j3076076aaa.jpg)。别忘了**加星标**，以免错过新推送提示。如果本文对你身边的亲友有帮助，也欢迎你把本文通过微博或朋友圈分享给他们。**延伸阅读**你可能也会对以下话题感兴趣。点击链接就可以查看。[如何把 Markdown 文件批量转换为 pdf？](https://zhuanlan.zhihu.com/p/44320384)[如何用 iPad 运行 Python 代码？](https://zhuanlan.zhihu.com/p/36830594)[如何用 Sikuli 自动录入成绩？](https://zhuanlan.zhihu.com/p/33131213)[如何高效学 Python ？](https://zhuanlan.zhihu.com/p/29631043)[《文科生数据科学上手指南》分享](https://zhuanlan.zhihu.com/p/44653452)题图：Photo by National Cancer Institute on Unsplash